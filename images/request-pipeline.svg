<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 400" style="font-family: Arial, sans-serif;">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#d9534f" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#333">API Request Pipeline</text>

  <!-- HTTP Request -->
  <rect x="20" y="80" width="100" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="70" y="100" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">HTTP</text>
  <text x="70" y="118" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">Request</text>

  <!-- CORS -->
  <rect x="145" y="80" width="80" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="185" y="114" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">CORS</text>

  <!-- Trace/Logging -->
  <rect x="250" y="80" width="90" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="295" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Trace/</text>
  <text x="295" y="123" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Logging</text>

  <!-- Body Limit -->
  <rect x="365" y="80" width="90" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="410" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Body Limit</text>
  <text x="410" y="123" text-anchor="middle" font-size="11" fill="#fff">(1MB)</text>

  <!-- Timeout -->
  <rect x="480" y="80" width="90" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="525" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Timeout</text>
  <text x="525" y="123" text-anchor="middle" font-size="11" fill="#fff">(30s)</text>

  <!-- Load Shed -->
  <rect x="595" y="80" width="90" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="640" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Load Shed</text>
  <text x="640" y="123" text-anchor="middle" font-size="11" fill="#fff">(5K)</text>

  <!-- Rate Limit -->
  <rect x="710" y="80" width="90" height="60" rx="8" fill="#95A5A6" stroke="#333" stroke-width="2"/>
  <text x="755" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Rate</text>
  <text x="755" y="123" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Limit</text>

  <!-- Auth -->
  <rect x="825" y="80" width="110" height="60" rx="8" fill="#4A90D9" stroke="#333" stroke-width="2"/>
  <text x="880" y="105" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">Auth</text>
  <text x="880" y="123" text-anchor="middle" font-size="10" fill="#fff">JWT/Key/mTLS</text>

  <!-- Handler -->
  <rect x="960" y="80" width="100" height="60" rx="8" fill="#5CB85C" stroke="#333" stroke-width="2"/>
  <text x="1010" y="114" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">Handler</text>

  <!-- SQLx Query -->
  <rect x="1085" y="80" width="100" height="60" rx="8" fill="#5F9EA0" stroke="#333" stroke-width="2"/>
  <text x="1135" y="105" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">SQLx</text>
  <text x="1135" y="123" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">Query</text>

  <!-- Response -->
  <rect x="1210" y="80" width="100" height="60" rx="8" fill="#5CB85C" stroke="#333" stroke-width="2"/>
  <text x="1260" y="114" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">Response</text>

  <!-- Main flow arrows -->
  <line x1="120" y1="110" x2="145" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="225" y1="110" x2="250" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="340" y1="110" x2="365" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="455" y1="110" x2="480" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="570" y1="110" x2="595" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="685" y1="110" x2="710" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="800" y1="110" x2="825" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="935" y1="110" x2="960" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1060" y1="110" x2="1085" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1185" y1="110" x2="1210" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Error paths -->
  <line x1="410" y1="140" x2="410" y2="220" stroke="#d9534f" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <line x1="525" y1="140" x2="525" y2="220" stroke="#d9534f" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <line x1="640" y1="140" x2="640" y2="220" stroke="#d9534f" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <line x1="755" y1="140" x2="755" y2="220" stroke="#d9534f" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <line x1="880" y1="140" x2="880" y2="220" stroke="#d9534f" stroke-width="2" marker-end="url(#arrowhead-red)"/>

  <!-- Error response boxes -->
  <rect x="360" y="220" width="100" height="50" rx="6" fill="#d9534f" stroke="#333" stroke-width="1.5"/>
  <text x="410" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">413 Payload</text>
  <text x="410" y="255" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Too Large</text>

  <rect x="475" y="220" width="100" height="50" rx="6" fill="#d9534f" stroke="#333" stroke-width="1.5"/>
  <text x="525" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">408 Request</text>
  <text x="525" y="255" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Timeout</text>

  <rect x="590" y="220" width="100" height="50" rx="6" fill="#d9534f" stroke="#333" stroke-width="1.5"/>
  <text x="640" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">503 Service</text>
  <text x="640" y="255" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Unavailable</text>

  <rect x="705" y="220" width="100" height="50" rx="6" fill="#d9534f" stroke="#333" stroke-width="1.5"/>
  <text x="755" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">429 Too Many</text>
  <text x="755" y="255" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Requests</text>

  <rect x="830" y="220" width="100" height="50" rx="6" fill="#d9534f" stroke="#333" stroke-width="1.5"/>
  <text x="880" y="240" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">401/403</text>
  <text x="880" y="255" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">Unauthorized</text>

  <!-- Legend -->
  <text x="100" y="340" font-size="12" font-weight="bold" fill="#333">Legend:</text>
  <rect x="100" y="350" width="50" height="25" rx="4" fill="#95A5A6" stroke="#333"/>
  <text x="160" y="367" font-size="11" fill="#333">Middleware</text>

  <rect x="250" y="350" width="50" height="25" rx="4" fill="#4A90D9" stroke="#333"/>
  <text x="310" y="367" font-size="11" fill="#333">Authentication</text>

  <rect x="420" y="350" width="50" height="25" rx="4" fill="#5CB85C" stroke="#333"/>
  <text x="480" y="367" font-size="11" fill="#333">Business Logic</text>

  <rect x="600" y="350" width="50" height="25" rx="4" fill="#5F9EA0" stroke="#333"/>
  <text x="660" y="367" font-size="11" fill="#333">Database</text>

  <rect x="770" y="350" width="50" height="25" rx="4" fill="#d9534f" stroke="#333"/>
  <text x="830" y="367" font-size="11" fill="#333">Error Response</text>
</svg>