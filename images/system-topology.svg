<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 620" font-family="Arial, Helvetica, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#555"/></marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#4A90D9"/></marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#5CB85C"/></marker>
  </defs>

  <!-- Title -->
  <text x="430" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">CloudVLAN System Topology</text>

  <!-- Control Plane Banner -->
  <rect x="20" y="50" width="820" height="200" rx="10" fill="#EBF2FA" stroke="#4A90D9" stroke-width="2"/>
  <text x="40" y="75" font-size="13" font-weight="bold" fill="#4A90D9">CONTROL PLANE</text>

  <!-- cvlan-api -->
  <rect x="240" y="90" width="380" height="140" rx="8" fill="#4A90D9" stroke="#3A7BC8" stroke-width="1.5"/>
  <text x="430" y="115" text-anchor="middle" font-size="15" font-weight="bold" fill="white">cvlan-api</text>
  <text x="430" y="133" text-anchor="middle" font-size="11" fill="#D4E6F9">REST API + Node Registration + Policy</text>

  <!-- Sub-boxes inside cvlan-api -->
  <rect x="255" y="145" width="85" height="35" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="297" y="167" text-anchor="middle" font-size="10" fill="white">Auth</text>
  <rect x="350" y="145" width="85" height="35" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="392" y="167" text-anchor="middle" font-size="10" fill="white">Multi-Tenant</text>
  <rect x="445" y="145" width="85" height="35" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="487" y="167" text-anchor="middle" font-size="10" fill="white">IP Alloc</text>
  <rect x="540" y="145" width="65" height="35" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="572" y="167" text-anchor="middle" font-size="10" fill="white">Audit</text>

  <!-- Ports on cvlan-api -->
  <rect x="255" y="190" width="55" height="22" rx="3" fill="#3A7BC8"/>
  <text x="282" y="205" text-anchor="middle" font-size="9" fill="white">:8080</text>
  <rect x="320" y="190" width="80" height="22" rx="3" fill="#3A7BC8"/>
  <text x="360" y="205" text-anchor="middle" font-size="9" fill="white">PostgreSQL</text>
  <rect x="410" y="190" width="65" height="22" rx="3" fill="#3A7BC8"/>
  <text x="442" y="205" text-anchor="middle" font-size="9" fill="white">step-ca</text>
  <rect x="485" y="190" width="55" height="22" rx="3" fill="#3A7BC8"/>
  <text x="512" y="205" text-anchor="middle" font-size="9" fill="white">SQLite</text>

  <!-- Management UI -->
  <rect x="680" y="90" width="140" height="65" rx="8" fill="#5BC0DE" stroke="#46B0CE" stroke-width="1.5"/>
  <text x="750" y="117" text-anchor="middle" font-size="13" font-weight="bold" fill="white">Management UI</text>
  <text x="750" y="135" text-anchor="middle" font-size="10" fill="white">React + TypeScript</text>
  <text x="750" y="148" text-anchor="middle" font-size="9" fill="#D4F0F7">:3000</text>

  <!-- Arrow: UI → API -->
  <line x1="680" y1="130" x2="625" y2="130" stroke="#5BC0DE" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="650" y="123" text-anchor="middle" font-size="9" fill="#555">REST</text>

  <!-- cvlanctl -->
  <rect x="40" y="100" width="140" height="55" rx="8" fill="#4A90D9" stroke="#3A7BC8" stroke-width="1.5"/>
  <text x="110" y="125" text-anchor="middle" font-size="13" font-weight="bold" fill="white">cvlanctl</text>
  <text x="110" y="142" text-anchor="middle" font-size="10" fill="#D4E6F9">Admin CLI</text>

  <!-- Arrow: cvlanctl → API -->
  <line x1="180" y1="130" x2="235" y2="130" stroke="#4A90D9" stroke-width="1.5" marker-end="url(#arrow-blue)"/>

  <!-- Vertical separator -->
  <line x1="20" y1="280" x2="840" y2="280" stroke="#DDD" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="430" y="300" text-anchor="middle" font-size="12" fill="#999">HTTPS / mTLS</text>

  <!-- Data Plane Banner -->
  <rect x="20" y="315" width="820" height="285" rx="10" fill="#F0FAF0" stroke="#5CB85C" stroke-width="2"/>
  <text x="40" y="340" font-size="13" font-weight="bold" fill="#5CB85C">DATA PLANE</text>

  <!-- VRouter -->
  <rect x="40" y="355" width="230" height="130" rx="8" fill="#5CB85C" stroke="#4CAE4C" stroke-width="1.5"/>
  <text x="155" y="380" text-anchor="middle" font-size="14" font-weight="bold" fill="white">vrouterd</text>
  <text x="155" y="398" text-anchor="middle" font-size="10" fill="#D4F0D4">VPP Gateway</text>

  <rect x="55" y="410" width="70" height="28" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="90" y="429" text-anchor="middle" font-size="9" fill="white">VPP</text>
  <rect x="135" y="410" width="70" height="28" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="170" y="429" text-anchor="middle" font-size="9" fill="white">WireGuard</text>
  <rect x="55" y="445" width="70" height="28" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="90" y="464" text-anchor="middle" font-size="9" fill="white">IPsec</text>
  <rect x="135" y="445" width="70" height="28" rx="4" fill="white" fill-opacity="0.2" stroke="white" stroke-opacity="0.4"/>
  <text x="170" y="464" text-anchor="middle" font-size="9" fill="white">DiffSync</text>

  <!-- vrouterctl -->
  <rect x="80" y="495" width="110" height="35" rx="6" fill="#5CB85C" stroke="#4CAE4C" stroke-width="1"/>
  <text x="135" y="517" text-anchor="middle" font-size="11" fill="white">vrouterctl</text>

  <!-- Client block -->
  <rect x="320" y="355" width="350" height="130" rx="8" fill="#F0AD4E" stroke="#E09C3E" stroke-width="1.5"/>
  <text x="495" y="380" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Client Node</text>

  <!-- Three crates inside client -->
  <rect x="335" y="395" width="95" height="50" rx="5" fill="white" fill-opacity="0.25" stroke="white" stroke-opacity="0.5"/>
  <text x="382" y="415" text-anchor="middle" font-size="11" font-weight="bold" fill="white">cvlan-ctrl</text>
  <text x="382" y="430" text-anchor="middle" font-size="9" fill="white">Control Plane</text>

  <rect x="440" y="395" width="95" height="50" rx="5" fill="white" fill-opacity="0.25" stroke="white" stroke-opacity="0.5"/>
  <text x="487" y="415" text-anchor="middle" font-size="11" font-weight="bold" fill="white">cvland</text>
  <text x="487" y="430" text-anchor="middle" font-size="9" fill="white">Data Plane</text>

  <rect x="545" y="395" width="95" height="50" rx="5" fill="white" fill-opacity="0.25" stroke="white" stroke-opacity="0.5"/>
  <text x="592" y="415" text-anchor="middle" font-size="11" font-weight="bold" fill="white">cvlancli</text>
  <text x="592" y="430" text-anchor="middle" font-size="9" fill="white">Debug CLI</text>

  <!-- IPC label -->
  <line x1="430" y1="445" x2="440" y2="445" stroke="white" stroke-width="1" stroke-dasharray="3,2"/>
  <text x="495" y="470" text-anchor="middle" font-size="9" fill="white">Unix Socket IPC</text>
  <line x1="430" y1="449" x2="545" y2="449" stroke="white" stroke-width="1" stroke-dasharray="3,2"/>

  <!-- Relay (future) -->
  <rect x="720" y="370" width="110" height="55" rx="8" fill="#95A5A6" stroke="#7F8C8D" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="775" y="395" text-anchor="middle" font-size="13" font-weight="bold" fill="white">Relay</text>
  <text x="775" y="412" text-anchor="middle" font-size="9" fill="white">(not started)</text>

  <!-- Arrows: Data plane → Control plane -->
  <line x1="155" y1="355" x2="350" y2="250" stroke="#5CB85C" stroke-width="1.5" marker-end="url(#arrow-green)"/>
  <text x="225" y="290" font-size="9" fill="#5CB85C" transform="rotate(-25,225,290)">mTLS poll</text>

  <line x1="430" y1="355" x2="430" y2="255" stroke="#F0AD4E" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="445" y="310" font-size="9" fill="#E09C3E">register / poll</text>

  <!-- Data plane mesh arrow -->
  <line x1="270" y1="430" x2="320" y2="430" stroke="#5CB85C" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="295" y="420" text-anchor="middle" font-size="9" fill="#5CB85C">WG</text>

  <!-- Client to client -->
  <text x="495" y="560" text-anchor="middle" font-size="11" fill="#888">Direct mesh (WireGuard) or via relay</text>
  <line x1="200" y1="540" x2="700" y2="540" stroke="#888" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="155" y1="495" x2="155" y2="540" stroke="#888" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="487" y1="485" x2="487" y2="540" stroke="#888" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="775" y1="425" x2="775" y2="540" stroke="#888" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- Legend -->
  <rect x="40" y="575" width="12" height="12" rx="2" fill="#4A90D9"/>
  <text x="58" y="586" font-size="10" fill="#555">Control Plane</text>
  <rect x="150" y="575" width="12" height="12" rx="2" fill="#5CB85C"/>
  <text x="168" y="586" font-size="10" fill="#555">Data Plane</text>
  <rect x="250" y="575" width="12" height="12" rx="2" fill="#F0AD4E"/>
  <text x="268" y="586" font-size="10" fill="#555">Client</text>
  <rect x="320" y="575" width="12" height="12" rx="2" fill="#5BC0DE"/>
  <text x="338" y="586" font-size="10" fill="#555">UI</text>
  <rect x="380" y="575" width="12" height="12" rx="2" fill="#95A5A6"/>
  <text x="398" y="586" font-size="10" fill="#555">Planned</text>
</svg>
